---

# **NPFCRM — Technical Onboarding Document (1-Page / Memory Block)**

## **1. Overview**

NPFCRM is a law-enforcement-oriented CRM built with **Node.js**, **Express**, **Prisma ORM**, and **MySQL**.
It manages **users (officers/admins)**, **cases**, and **reports**, with strict relational links between them.
The backend exposes **REST APIs** for authentication, case management, officer assignments, and report creation.

---

## **2. Tech Stack**

* **Backend:** Node.js + Express
* **Database:** MySQL
* **ORM:** Prisma (v5.22.0)
* **Auth:** JWT (typical email/password login)
* **Environment:** Local development using `.env` for DB credentials

---

## **3. Core Database Models**

### **User**

Represents officers or admins using the system.
Key fields: `id`, `name`, `email`, `password`, `role`.
Relations:

* `assignedCases`: list of Cases where this user is the assigned officer
  (`@relation("AssignedOfficer")`)
* `generatedReports`: list of Reports authored by this user
  (`@relation("ReportGenerator")`)

---

### **Case**

Represents a police investigation case.
Key fields: `id`, `title`, `description`, `status`, `suspectName`, timestamps.
Relations:

* `officerId` → foreign key to User
* `officer` → assigned officer (`User?`)
* `reports` → list of Reports attached to this Case

---

### **Report**

Represents a documented event or update linked to a case.
Key fields: `id`, `content`, timestamps.
Relations:

* `caseId` → belongs to a Case
* `generatedById` → authored by a User
* Relation names match User model’s back-relations (`"ReportGenerator"`)

---

## **4. Relationship Summary**

* **User ↔ Case**

  * One user can be assigned to many cases
  * Case has `officerId` and `officer` fields
  * Relation name: `"AssignedOfficer"`

* **User ↔ Report**

  * One user can generate many reports
  * Report has `generatedById` and `generatedBy` fields
  * Relation name: `"ReportGenerator"`

* **Case ↔ Report**

  * Case can have many reports
  * Report belongs to one case

All relations are now valid and Prisma migrations run cleanly.

---

## **5. Current Project State**

* Schema errors were fixed by adding the missing back-relations in `User`.
* `prisma db pull` and `prisma generate` run successfully.
* Prisma Client is working.

---

## **6. Typical Backend Features**

* User authentication (login, JWT).
* CRUD endpoints for Users, Cases, and Reports.
* Case assignment to officers.
* Report creation mapped to a case + officer.
* Filtering cases by status, officer, or date range.
* Basic admin/role permissions.

---

## **7. Expected Next Tasks**

* Implement role-based access control (admin vs officer).
* Case reassignment workflow.
* Attachments or file uploads for reports.
* Dashboard analytics endpoints.
* API error-handling cleanup and validation.

---

## **8. Guiding Principle**

Every Case must have **0–1 assigned officer**,
every Report must have **one Case** and **one generating User**,
and all model relations must stay consistent with Prisma’s naming.

---

Project Structure

npf-crm/
├── node_modules/
├── prisma/
│   ├── schema.prisma
│   ├── seed.js
│   └── migrations/
├── src/
│   ├── config/
│   │   └── db.js
│   ├── controllers/
│   │   ├── auth.controller.js
│   │   ├── user.controller.js
│   │   ├── case.controller.js
│   │   ├── officer.controller.js
│   │   ├── report.controller.js
│   │   └── incident.controller.js
│   ├── middleware/
│   │   ├── auth.js
│   │   ├── admin.js
│   │   └── errorHandler.js
│   ├── routes/
│   │   ├── authRoutes.js
│   │   ├── userRoutes.js
│   │   ├── caseRoutes.js
│   │   ├── officerRoutes.js
│   │   ├── reportRoutes.js
│   │   └── incidentRoutes.js
│   └── app.js              ← Backend Express server
├── public/                  ← Frontend files (HTML, CSS, JS)
│   ├── index.html          ← Main dashboard
│   ├── login.html
│   ├── change-password.html
│   ├── create-user.html
│   ├── js/
│   │   ├── app.js          ← Frontend application logic
│   │   └── api.js          ← Frontend API calls
│   └── css/
│       └── styles.css
├── .env
├── package.json
└── package-lock.json

--------

***  Packages installed for Project


package.json

{
  "name": "npf-crm-backend",
  "version": "1.0.0",
  "description": "National Police Force CRM Backend API",
  "main": "src/app.js",
  "scripts": {
    "start": "node src/app.js",
    "dev": "nodemon src/app.js",
    "db:migrate": "npx prisma migrate dev",
    "db:push": "npx prisma db push",
    "db:seed": "node prisma/seed.js",
    "db:reset": "npx prisma migrate reset",
    "db:studio": "npx prisma studio",
    "postinstall": "npx prisma generate"
  },
  "dependencies": {
    "@prisma/client": "^5.0.0",
    "bcryptjs": "^2.4.3",
    "cors": "^2.8.5",
    "dotenv": "^16.0.0",
    "express": "^4.18.2",
    "jsonwebtoken": "^9.0.0"
  },
  "devDependencies": {
    "nodemon": "^3.0.0",
    "prisma": "^5.0.0"
  }
}